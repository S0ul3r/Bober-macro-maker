<Window x:Class="WWMBoberRotations.Views.MacroRecorderWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Record Macro" 
        Height="600" 
        Width="700"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource MaterialDesignWindow}"
        Background="{DynamicResource MaterialDesignPaper}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Grid.Row="0" 
                   Text="Macro Recorder" 
                   FontSize="24"
                   FontWeight="Bold"
                   Margin="0,0,0,20"/>

        <!-- Combo Name -->
        <TextBox Grid.Row="1" 
                 x:Name="ComboNameTextBox"
                 materialDesign:HintAssist.Hint="Combo Name"
                 Text="{Binding ComboName, UpdateSourceTrigger=PropertyChanged}"
                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                 Margin="0,0,0,15"/>

        <!-- Record Hotkey Configuration -->
        <Grid Grid.Row="2" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBox Grid.Column="0" 
                     x:Name="RecordHotkeyTextBox"
                     materialDesign:HintAssist.Hint="Record Hotkey (Start/Stop recording)"
                     Text="{Binding RecordHotkey, UpdateSourceTrigger=PropertyChanged}"
                     IsReadOnly="True"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     Margin="0,0,10,0"/>
            
            <Button Grid.Column="1" 
                    Content="Set Hotkey"
                    Click="SetRecordHotkey_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Margin="0,0,10,0"/>
            
            <Button Grid.Column="2" 
                    Content="Clear"
                    Click="ClearRecordHotkey_Click"
                    Style="{StaticResource MaterialDesignOutlinedButton}"/>
        </Grid>

        <!-- Recorded Actions List -->
        <materialDesign:Card Grid.Row="4" Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" 
                            Orientation="Horizontal"
                            Margin="15,15,15,10">
                    <TextBlock Text="Recorded Actions" 
                               FontSize="16"
                               FontWeight="Bold"/>
                    <TextBlock x:Name="ActionCountText"
                               Text=" (0)"
                               FontSize="16"
                               Foreground="{DynamicResource MaterialDesignBodyLight}"
                               Margin="5,0,0,0"/>
                </StackPanel>

                <!-- Wrap ListBox in Grid for overlay -->
                <Grid Grid.Row="1">
                    <ListBox x:Name="ActionsListBox"
                             AllowDrop="True"
                             PreviewMouseLeftButtonDown="ActionsListBox_PreviewMouseLeftButtonDown"
                             PreviewMouseMove="ActionsListBox_PreviewMouseMove"
                             Drop="ActionsListBox_Drop"
                             DragOver="ActionsListBox_DragOver"
                             Margin="15,0,15,0">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                                <Setter Property="Padding" Value="8,4"/>
                                <Setter Property="MinHeight" Value="32"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0} {1}">
                                            <Binding Path="Type"/>
                                            <Binding Path="Description"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <!-- Drop indicator line -->
                    <Canvas x:Name="DropIndicatorCanvas" 
                            IsHitTestVisible="False"
                            Margin="15,0,15,0">
                        <Border x:Name="DropIndicator"
                                Background="Orange"
                                Height="2"
                                Width="0"
                                Visibility="Collapsed"/>
                    </Canvas>
                </Grid>

                <StackPanel Grid.Row="2" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Right"
                            Margin="15,10,15,15">
                    <Button x:Name="ClearAllButton"
                            Content="Clear All"
                            Click="ClearAll_Click"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            IsEnabled="False"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Status and Action Buttons -->
        <Grid Grid.Row="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Status Message -->
            <TextBlock x:Name="StatusText"
                       Grid.Row="0"
                       Text="Set a hotkey and press it to start recording"
                       Foreground="{DynamicResource MaterialDesignBodyLight}"
                       Margin="0,0,0,15"/>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="1" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right">
                <Button Content="CANCEL"
                        Click="Cancel_Click"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Height="36"
                        Padding="20,0"
                        Margin="0,0,10,0"/>
                
                <Button x:Name="SaveButton"
                        Content="SAVE AS COMBO"
                        Click="Save_Click"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Height="36"
                        Padding="20,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
